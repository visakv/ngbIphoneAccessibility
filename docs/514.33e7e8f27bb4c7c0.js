"use strict";(self.webpackChunkduet_angular_template=self.webpackChunkduet_angular_template||[]).push([[514],{2514:(O,r,n)=>{n.r(r),n.d(r,{duet_combobox:()=>m});var d=n(5861),s=n(3671),h=n(7226),l=n(8369),u=n(3838),b=n(3995),p=n(290);const x=({item:t,search:e="",selected:i})=>{const o=""!==e?new RegExp("("+e.split(" ").join("|")+")","gi"):void 0;return(0,s.h)(s.F,null,i&&(0,s.h)("duet-icon",{class:"option-icon",name:"messaging-checked",size:"xx-small",margin:"none"}),o?(0,s.h)("span",{class:"option-container","aria-hidden":"true"},(0,s.h)("span",{innerHTML:t.name.replace(o,'<span class="highlight">$&</span>')})):t.name,t.tags&&(0,s.h)("span",{class:"option-tags"},t.tags.join(", ")))},f=({item:t,active:e,total:i,selected:o,label:a,clickHandler:g=(c=>{c.preventDefault()}),keyHandler:I=(c=>{c.preventDefault()}),search:_})=>(0,s.h)("li",{class:{"list-item":!0,option:!0,active:e,selected:o},id:e?"active_item":"","data-index":t.id,"aria-selected":e?"true":void 0,"aria-current":o?"true":void 0,role:"option","aria-label":a||`${t.name}, (${t.id+1} of ${i})`},(0,s.h)("a",{tabindex:"-1",onClick:c=>g(c),onKeyUp:c=>I(c),class:"option-link","aria-label":a||`${t.name}, (${t.id+1} of ${i})`,"aria-hidden":"true"},(0,s.h)(x,{item:t,search:_,selected:o}))),m=class{constructor(t){(0,s.r)(this,t),this.duetChange=(0,s.c)(this,"duetChange",3),this.isSafari=!1,this.resizeObserver=new ResizeObserver((0,h.d)(e=>{var i,o;if(1===(null==e?void 0:e.length)){const a=null===(o=null===(i=e[0])||void 0===i?void 0:i.target)||void 0===o?void 0:o.getBoundingClientRect().width;this.listContainer.style.width=`${a+1}px`}},100)),this.processedItems=null,this.inputWidth=0,this.inputValue="",this.selectionMsg="",this.listOpen=!1,this.selectedItems=new Set,this.activeItem=void 0,this.accessibleLabelDefaults={en:{heading:"Select:",item:"{name}, ({current} of {total})",itemFiltered:"{name}, ({current} of {total}, {hiddenItems} filtered)"},fi:{heading:"Valitse:",item:"{name}, ({current}/{total})",itemFiltered:"{name}, ({current}/{total}, {hiddenItems} suodatettu)"},sv:{heading:"V\xe4lj:",item:"{name}, ({current} av {total})",itemFiltered:"{name}, ({current} av {total}, {hiddenItems} filtrerade)"}},this.accessibleLabels=(0,u.g)((0,b.p)(this.accessibleLabelDefaults),(0,u.a)()),this.theme="",this.force=!1,this.formatter=e=>e&&e.name?e.name:""}activeItemHandler(t){this.input.accessibleActiveDescendant=this.listOpen&&(t||0===t)?"active_item":""}handleDocumentClick(t){t.composedPath().every(o=>o!==this.element)&&(this.updateInputText(!0),this.listOpen=!1)}formatItem(t){var e=this;return(0,d.Z)(function*(){return e.formatter(t)})()}componentWillLoad(){(0,p.i)(this)}connectedCallback(){/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&(this.isSafari=!0),this.items=this.processedItems=(0,b.p)(this.items),this.input=this.element.querySelector("duet-input"),this.input.addEventListener("duetChange",this.updateInputValue.bind(this)),this.input.addEventListener("click",()=>{this.listOpen=!!this.inputValue.length}),this.element.addEventListener("keydown",this.handleInputKeyDownEvent.bind(this)),this.input.accessibleAutocomplete="list",this.input.accessibleControls="duet-combobox-list-element"}disconnectedCallback(){this.input.removeEventListener("duetChange",this.updateInputValue.bind(this)),this.input.removeEventListener("click",()=>this.listOpen=!!this.inputValue.length),this.element.removeEventListener("keydown",this.handleInputKeyDownEvent.bind(this)),this.listElement.removeEventListener("click",t=>{t.stopPropagation()}),this.resizeObserver.disconnect()}componentDidLoad(){this.resizeObserver.observe(this.input),this.listElement.addEventListener("click",t=>{t.stopPropagation()})}onListClick(t,e){return t.preventDefault(),this.updateSelectedItems(e.id),this.listOpen=!1,this.listOpen}shouldListBeFiltered(){if(this.selectedItems.size&&this.input.value===this.inputValue){const t=this.items.filter(e=>this.selectedItems.has(e.id));return this.formatter(t).toLowerCase()!==this.input.value.toLowerCase()}return!0}returnFilteredOrNonFiltered(){return this.processedItems?this.shouldListBeFiltered()?this.getFilteredItems():this.sortFilteredItems(this.processedItems):[]}updateSelectedItems(t){var e=this;return(0,d.Z)(function*(){e.selectedItems.clear(),e.selectedItems&&(e.selectedItems.has(t)?e.selectedItems.delete(t):e.selectedItems.add(t)),yield e.updateInputText()})()}updateInputText(t=!1){var e=this;return(0,d.Z)(function*(){const i=0===e.selectedItems.size?[]:e.items.filter(o=>e.selectedItems.has(o.id));1===e.selectedItems.size?(e.input.value="",e.input.value=yield e.formatItem(i[0]),e.input.scrollLeft=e.input.scrollWidth,e.activeItem=void 0,e.value=yield e.formatItem(i[0]),e.duetChange.emit({value:i[0].value,item:i[0],component:"duet-combobox"})):t&&0===e.selectedItems.size&&(e.force&&(e.inputValue="",e.input.value=""),e.activeItem=void 0),e.listOpen=!1})()}updateInputValue(t){var e;this.inputValue=t.detail.value,this.listOpen=String(this.inputValue).length>0&&(null===(e=this.getFilteredItems())||void 0===e?void 0:e.length)>0}handleInputKeyDownEvent(t){if(this.input.accessibleActiveDescendant=void 0,(0,l.n)(t))return t.preventDefault(),this.selectActiveItem(),void(this.listOpen=!1);if((0,l.f)(t)||(0,l.o)(t))return this.updateInputText(!0),void(this.listOpen=!1);let e=this.activeItem;if((0,l.b)(t)?(t.preventDefault(),e=this.activeItem-1):(0,l.c)(t)&&(t.preventDefault(),e=this.listOpen?this.activeItem+1:this.activeItem,this.listOpen=!0),(0,l.c)(t)||(0,l.b)(t)){const i=this.shouldListBeFiltered()?this.getFilteredItems():this.processedItems;(e<0||!e)&&(e=0),e>=i.length&&(e=i.length-1),this.input.accessibleActiveDescendant="active_item",this.activeItem=e,this.scrollToActive()}this.announceActive()}selectActiveItem(){if(void 0===this.activeItem)return;const e=this.returnFilteredOrNonFiltered()[this.activeItem];this.updateSelectedItems(e.id)}announceActive(t){t||(t=this.returnFilteredOrNonFiltered()),void 0!==this.activeItem&&-1!==this.activeItem&&(this.selectionMsg=this.formatLabel(t[this.activeItem],t.length,this.items.length))}scrollToActive(){const t=this.listElement.querySelector(".active");t&&t.scrollIntoView({behavior:"smooth",block:"center"})}formatLabel(t,e,i){return t&&void 0!==i?(e===i?this.accessibleLabels.item:this.accessibleLabels.itemFiltered).replace("{name}",String(t.name)).replace("{current}",String(this.activeItem+1)).replace("{total}",String(e)).replace("{hiddenItems}",String(i-e)):""}getFilteredItems(){const t=this.processedItems.filter(e=>String(e.value).toLowerCase().includes(this.inputValue.toLowerCase())||String(e.name).toLowerCase().includes(this.inputValue.toLowerCase())||this.selectedItems.has(e.id));return this.sortFilteredItems(t)}sortFilteredItems(t){return t.length>0&&t.filter(e=>this.selectedItems.has(e.id)).forEach(e=>{const i=t.indexOf(e);t.splice(i,1),t.unshift(e)}),t}render(){const t=this.returnFilteredOrNonFiltered();return(0,s.h)(s.H,{role:"combobox","aria-expanded":this.listOpen?"true":"false","aria-owns":this.listOpen?"duet-combobox-list-element":void 0,"aria-haspopup":"listbox",class:{"duet-combobox":!0,[`duet-theme-${this.theme}`]:!0}},(0,s.h)("slot",null),this.isSafari&&(0,s.h)("duet-visually-hidden",{"aria-live":"assertive","aria-atomic":"true","aria-relevant":"all"},this.selectionMsg),(0,s.h)("div",{role:"list",class:{"duet-combobox-list":!0,open:this.listOpen},ref:e=>this.listContainer=e},(0,s.h)("ul",{role:"listbox",ref:e=>this.listElement=e,id:"duet-combobox-list-element",class:"listbox"},this.processedItems&&t.map((e,i)=>(0,s.h)(f,{item:e,active:i===this.activeItem,selected:this.selectedItems.has(e.id),search:this.inputValue,total:t.length,clickHandler:o=>this.onListClick(o,e),label:this.formatLabel(e,this.returnFilteredOrNonFiltered().length,this.items.length)})))))}get element(){return(0,s.g)(this)}static get watchers(){return{activeItem:["activeItemHandler"]}}};m.style='.sc-duet-combobox-h{box-sizing:border-box;padding:0;margin:0;background:transparent;border:0;-moz-appearance:none;-webkit-appearance:none;appearance:none;position:relative;width:auto;font-family:"localtapiola-sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";color:#00294d}.duet-combobox-list.sc-duet-combobox{position:absolute;top:calc(100% - 12px);display:none;overflow:hidden;background:white;border-radius:0 4px;box-shadow:0 2px 10px 0 rgba(0, 41, 77, 0.1)}.duet-combobox-list.open.sc-duet-combobox{z-index:700;display:block}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox{max-height:200px;padding:0.75rem 0;margin:0;overflow-y:scroll;font-weight:600;list-style:none;cursor:pointer;scroll-behavior:smooth}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox{padding:4px 0}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:not(.selected){padding-left:16px}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:not(.selected) .highlight.sc-duet-combobox{text-decoration:underline}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.option.sc-duet-combobox .option-link.sc-duet-combobox{display:block;width:100%}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.option.sc-duet-combobox .option-tags.sc-duet-combobox{float:right;padding-right:0.875rem;font-weight:400;color:#909599}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.option-link.sc-duet-combobox{display:block;width:100%}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.selected.sc-duet-combobox{padding-left:0;background:#cde5f1}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.selected.option.sc-duet-combobox .option-icon.sc-duet-combobox{padding:0 8px 0 8px}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.selected.option.sc-duet-combobox .option-tags.sc-duet-combobox{color:#909599}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.active.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:focus,.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:hover{color:white;background:#0077b3}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.active.sc-duet-combobox .option-tags.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:focus .option-tags.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:hover .option-tags.sc-duet-combobox{color:#e1e3e6}'}}]);